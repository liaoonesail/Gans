<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>店铺列表</title>
		<link rel="stylesheet" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/swiper.css" />
		<link rel="stylesheet" href="../css/bass.css" />
		<link rel="stylesheet" href="../css/header.css" />
		<link rel="stylesheet" href="../css/discoNav.css" />
		<link rel="stylesheet" href="../css/Local.css" />
		<style>
			.LocalBanner  .swiper-container{
				width: 100%;
			    height: 100%;
			}
			.LocalBanner  .swiper-slide {
				width: 100%;
				height: 100%;
			        background-position: center;
			        background-size: 100% 100%;
			}
			
			.LocalBanner  .swiper-container .swiper-pagination-white .swiper-pagination-bullet-active {
			    background: #ef1932;
			}
			.LocalBanner .swiper-container .swiper-pagination {
				position: absolute;
				text-align: center;
				-webkit-transition: 300ms;
				-moz-transition: 300ms;
				-o-transition: 300ms;
				transition: 300ms;
				-webkit-transform: translate3d(0, 0, 0);
				-ms-transform: translate3d(0, 0, 0);
				-o-transform: translate3d(0, 0, 0);
				transform: translate3d(0, 0, 0);
				z-index: 10;
				right: 0px;
				bottom: 0px;
			}			
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">店铺列表</h1>
		    <span class="mui-pull-right mui-action-back"  style="color: #fff;font-size: 13px;line-height: 44px;">关闭</span>
		</header>
		<div class="mui-content">
			<!--地方汇搜索-->
			<div class="mui-row">
				<div class="mui-col-xs-12 Localsearch clearfix">
					<span id="searchCode" class="mui-icon mui-icon-search" style="margin-left: 6px;"></span>
					<input id="searchName" type="search" class="text-clear-content" placeholder="搜索" />
					<div class="clear-button22"></div>
				</div>
			</div>
			<!--地方汇搜索-->
			<div class="mui-row">
				<div class="mui-col-xs-3">
					<div class="mui-scroll-wrapper LocalUlLi">
					    <div class="mui-scroll">
					        <!--这里放置真实显示的DOM内容-->
					        <ul id="ListNavService">
					    		
					    	</ul>
					    </div>
					</div>
					
				</div>
				<div class="mui-col-xs-9">
					<div class="rightLocal">
						
						<div class="rightLocalList" style="display: block;">
							<!--轮播部分-->
							<div class="LocalBanner">
								<div class="swiper-container">
									<div id="shop_Img_new" class="swiper-wrapper">
										<!-- <div class="swiper-slide" style="background-image:url(../img/banner/Lobanner.jpg)"></div>
										<div class="swiper-slide" style="background-image:url(../img/banner/banner2.jpg)"></div>
										<div class="swiper-slide" style="background-image:url(../img/banner/banner3.png)"></div> -->
									</div>
									<!-- Add Pagination -->
									<div class="swiper-pagination swiper-pagination-white"></div>
								</div>								
							</div>
							<!--轮播部分-->
							<!--二个商品-->
							
							<!--二个商品-->
							<!--广告图-->
							<div  id="LocalbannerImg">
							</div>
							
							<!--广告图-->
							<!--商户推荐-->
							<div class="merchantBox">
								<!-- <div class="merchantBoxTitle clearfix">
									<h3>商户推荐</h3>
									<span>查看更多<i class="mui-icon mui-icon-forward"></i></span>
								</div> -->
								<div id="dianpu_List" class="mui-row">
									<!-- <div   class="mui-col-xs-12 merchantBoxList clearfix">
										<div class="merchantBoxList1">
											<img src="../img/smallImg/mui1.jpg" />
										</div>
										<div class="merchantBoxList2">
											<h3>店铺名称：未来之家</h3>
											<p>优惠力度：20%</p>
											<p>联系地址：兰州市城关区光源大厦</p>
											<p>联系电话：18919040107</p>
										</div>
									</div> -->
									
								</div>
							</div>
							<!--商户推荐-->
						</div>					
					</div>
				</div>
			</div>
		</div>
		<!-- 加载提示 -->
		    <div id="loadingicon" class="mui-text-center">
				<span class="mui-spinner"></span>
				<p style="margin-bottom: 0px;font-size: 12px;">正在加载中....</p>
			</div>
		    <!-- 加载提示 -->
        <div style="height: 55px;"></div>
		<!--底部导航-->
		<div class="bgcolor footer22">
			<div class="footer144" onclick="javascript:window.location.href='../../index.html'">
				<img class="mui-icon-home1" src="../img/smallImg/nav1.png" />
			    <p>首页</p>
			</div>
			<div class="footer144" onclick="javascript:window.location.href='discountgo.html'">
				<img class="mui-icon-email12" src="../img/smallImg/18.png" />
			    <p>善融</p>
			</div>
			<div class="footer144" onclick="javascript:window.location.href='../../Local1.html'">
				<img class="mui-icon-home1" src="../img/smallImg/19.png" />
			    <p>地方汇</p>
			</div>
			<div class="footer144" onclick="javascript:window.location.href='../../special1.html'">
				<img class="mui-icon-home1" src="../img/smallImg/20.png" />
			    <p>专场</p>
			</div>
			<div class="footer144" onclick="javascript:window.location.href='personalcenter.html'">
				<img class="mui-icon-gear1" src="../img/smallImg/nav4.png" />
			    <p>个人中心</p>
			</div>	
		</div>
		<!--底部导航-->
	</body>
	<script type="text/javascript" src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/jquery-1.10.2.js"></script>
	<script type="text/javascript" src="../js/swiper.min.js" ></script>
	<!-- 引入地区js -->
	<script type="text/javascript" src="../js/publicAddress.js" ></script>
	<script type="text/javascript" src="../js/activity/activity.js" ></script>
	<script type="text/javascript" src="../js/area/area.js" ></script>
	<!-- <script type="text/javascript" src="../js/advert/advert.js" ></script> -->
	<script type="text/javascript" src="../js/search/search.js" ></script>
	<script>
		mui.init();
		/**
 * 轮播图集合（one_lb,zzh_lb,long_lb,sr_lb,dfh_lb）(首页轮播、周周惠轮播、龙支付轮播、善融轮播、地方汇轮播)
 * @param location
 * @param response
 * @return
 * @throws IOException 
 */
function getAdvertByStatus(location){
	var url = "advert/lbList.do";
	var data = {
			location:location
    };
	async = false;
	var result = ajaxSubmit(url, data, async);
	//console.log(result)
	return result;
}
/**
 * 根据位置获取单个图片
 * @param location
 * @param response
 * @return
 * @throws IOException 
 */
function getOnePic(location){
	var url = "advert/getOne.do";
	var data = {
			location:location
    };
	async = false;
	var result = ajaxSubmit(url, data, async);
	//console.log(result)
	return result;
}
		//让指定的DIV始终显示在屏幕正中间   
	     left_w=($(document).width()-$('#loadingicon').width())/2;  
	     top_w = $('html').scrollTop()+($(window).height()-$('#loadingicon').height())/2;  
	     $('#loadingicon').offset({top:top_w,left:left_w});  
		//区域滚动
		mui('.mui-scroll-wrapper').scroll({
			deceleration: 0.0005 ,//flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
			indicators: true
		});	
	 $('#loadingicon').show();
     $('#loadingicon').offset({top:top_w,left:left_w});  
     setTimeout(function(){
	       $('#loadingicon').hide();
	        area_start();
	      
			//获取该区域所有供应商
			getAreaShop_dianpu_1();
			//获取该区域的广告图片
			shop_area_conts_bannerList();
			 
 	 },300);
	function area_start(){
		var color_ = "",area_id ="";
		var getCheckedArea_=getCheckedArea();
		getCheckedArea_ = JSON.parse(getCheckedArea_);
		area_id =getCheckedArea_;
		/**
		 * 获取所有地区
		 * @returns
		 */
		var area_List =getArea();
		// console.log("获取所有地区=="+area_List)
		area_List = JSON.parse(area_List);
		
		$("#ListNavService").empty();
		var arae_List_html ="";
		/**
		 * 获取用户所选区域
		 * @returns 该区域对象
		 */	
		var getCheckedArea_true =getCheckedArea();
		getCheckedArea_true = JSON.parse(getCheckedArea_true);
		var getCheckedArea_true_id =getCheckedArea_true.id;
		for(var i = 0; i < area_List.length; i++){
			arae_List_html +="<li id='"+area_List[i].id+"' area_id='"+area_List[i].id+"'>"+area_List[i].name+"</li>";		
			if(area_List[i].id == getCheckedArea_true_id){
				area_id = getCheckedArea_true_id;
				color_ =area_List[i].id;
			}
		}
		$("#ListNavService").append(arae_List_html);
		/**
		 * 获取用户所选区域
		 * @returns 该区域对象
		 */	
		$("#"+color_).addClass("navLocalOk");
		/**
		 * 修改所选地区
		 * @param area 地区ID
		 * @returns 成功返回"ok"
		 */
		 $("ul#ListNavService li").click(function() {
			$("ul#ListNavService  li").removeClass("navLocalOk"); //siblings是循环遍历
			$(this).addClass("navLocalOk");
			 var area_id =$(this).attr("area_id");
			 /**
			  * 修改所选地区
			  * @param area 地区ID
			  * @returns 成功返回"ok"
			  */
			 var getCheckedArea = changeArea(area_id);
			 //shop_area_conts(area_id);
			 getAreaShop_dianpu_1(area_id); 
			 
		});
		
	} 
	 /**
	 * 获取该区域所有供应商
	 * @param area 区域ID
	 * @returns 供应商集合
	 */
	function   getAreaShop_dianpu_1(){
		 var getCheckedArea_=getCheckedArea();
		 getCheckedArea_ = JSON.parse(getCheckedArea_);
		 area_id_banner =getCheckedArea_.id;
		 var getAreaShop_ =getAreaShop(area_id_banner);
		// console.log("获取该区域所有供应商==="+getAreaShop_);
		 getAreaShop_ = JSON.parse(getAreaShop_);
		 if(getAreaShop_ != null){
		   $("#dianpu_List").empty();
		   var dianpu_List_ ="";
		   for(var i = 0; i<getAreaShop_.length; i++){
			   dianpu_List_  +="<div id='"+getAreaShop_[i].id+"'  class='mui-col-xs-12 merchantBoxList clearfix'>"
								+"<div class='merchantBoxList1'>"
									+"<img src='"+getAreaShop_[i].picture_address+"' />"
								+"</div>"
								+"<div class='merchantBoxList2'>"
									+"<h3>店铺名称："+getAreaShop_[i].shop_name+"</h3>"
									+"<p>优惠力度："+getAreaShop_[i].youhui+"</p>"
									+"<p>联系地址："+getAreaShop_[i].address+"</p>"
									+"<p>联系电话："+getAreaShop_[i].phone+"</p>"
								+"</div>"
							+"</div>"; 
		     }	
		   $("#dianpu_List").append(dianpu_List_);
		   var abc_dipuY = $(".merchantBoxList");
		   for (var i = 0; i < abc_dipuY.length; i++) {
			    (function(e){  //自执行函数实时把i传入e
			        abc_dipuY[e].onclick=function(){  //  通过传入的e获取到哪个按钮发生了点击事件
//			            alert(e) //弹出e（此处e为i实时对应值）
                        var shop_details_Id_conts =$(this).attr("id");
	                  setTimeout(function(){
							mui.openWindow({
								url: 'shop_details.html?id='+shop_details_Id_conts,
								id: 'shop_details',
								showType: 'zoom-fade-out',
								showTime: 200
							});
						},200); 
			        }
			    })(i)    
			};   //采用闭包和自执行函数获取i	
	     }
	 }		
	 /**
		 * 获取该区域的广告图片
		 * @param area
		 * @returns
		 */
		
		function shop_area_conts_bannerList(){
		var localImg = getAdvertByStatus("dfh_lb");
		//console.log(" 获取该区域的广告图片=="+localImg);
			localImg = JSON.parse(localImg);
			var shop_fenglei_Img = "";
			$("#shop_Img_new").empty();
			for(var i = 0;i<localImg.length;i++){
				shop_fenglei_Img+="<div  onclick=\"javascript:window.location.href='"+localImg[i].ad_url+"'\" class='swiper-slide' style='background-image:url("+localImg[i].picture_address+")'></div>";
			}
			$("#shop_Img_new").append(shop_fenglei_Img);
			//轮播图
			var swiper = new Swiper('.swiper-container', {
				pagination: '.swiper-pagination',
				paginationClickable: '.swiper-pagination',
				loop: true,
				spaceBetween: 30,
				autoplay: 2500,
				autoplayDisableOnInteraction: false,
				effect: 'fade'
			});
		}
		
		 //merchantBoxList跳转对应的店铺详情
		//单个大的搜索框点击得到焦点清空input的内容
		$(".text-clear-content").focus(function() {
	    	$(".clear-button22").hide();
	    	$(this).next(".clear-button22").show();
	        
	    });	
	    $(".clear-button22").click(function() {
	    	$(this).prev().val("");
	    	$(this).prev().focus();
	    	//$(".text-clear-content").blur(function(){
	    		$(".clear-button22").hide();
	    	//});
	    });
	   
	</script>

</html>